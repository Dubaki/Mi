/*
==========================================================================================
ПРОЕКТ: МИШУРА - Ваш персональный ИИ-Стилист
КОМПОНЕНТ: Основной загрузчик (app.js)
ВЕРСИЯ: 0.4.0 (Модульная структура)
ДАТА ОБНОВЛЕНИЯ: 2025-05-20

МЕТОДОЛОГИЯ РАБОТЫ И ОБНОВЛЕНИЯ КОДА:
1.  Целостность Обновлений: Любые изменения файлов предоставляются целиком.
    Частичные изменения кода не допускаются для обеспечения стабильности интеграции.
2.  Язык Коммуникации: Комментарии и документация ведутся на русском языке.
3.  Стандарт Качества: Данный код является частью проекта "МИШУРА", разработанного
    с применением высочайших стандартов программирования и дизайна, соответствуя
    уровню лучших мировых практик.

НАЗНАЧЕНИЕ ФАЙЛА:
Основной загрузчик JavaScript-модулей для веб-приложения МИШУРА.
Управляет загрузкой всех модулей и инициализацией приложения.
==========================================================================================
*/

// Начальное сообщение о загрузке
console.log('МИШУРА app.js загружен - инициализация модульной структуры...');

// Основная функция инициализации приложения
document.addEventListener('DOMContentLoaded', function() {
    // Проверяем, правильно ли загружены модули
    if (!window.MishuraApp) {
        console.error('ОШИБКА: Основные модули МИШУРА не загружены. Проверьте порядок загрузки скриптов.');
        showFallbackError();
        return;
    }
    
    // Инициализация модулей в правильном порядке с учетом зависимостей
    try {
        // 1. Сначала инициализируем конфигурацию (не требует инициализации)
        console.log('Инициализация конфигурации завершена');
        
        // 2. Базовые утилиты
        window.MishuraApp.utils.logger.debug('Инициализация логгера завершена');
        window.MishuraApp.utils.deviceDetect.init();
        window.MishuraApp.utils.uiHelpers.init();
        console.log('Базовые утилиты инициализированы');
        
        // 3. Коммуникация с API
        window.MishuraApp.api.service.init();
        console.log('API-сервис инициализирован');
        
        // 4. Компоненты интерфейса
        window.MishuraApp.components.modals.init();
        window.MishuraApp.components.navigation.init();
        window.MishuraApp.components.imageUpload.init();
        console.log('Компоненты интерфейса инициализированы');
        
        // 5. Функциональные модули
        window.MishuraApp.features.consultation.init();
        window.MishuraApp.features.comparison.init();
        window.MishuraApp.features.tryOn.init();
        console.log('Функциональные модули инициализированы');
        
        // 6. Главный модуль приложения
        window.MishuraApp.init();
        console.log('МИШУРА успешно инициализирована');
    } catch (error) {
        console.error('КРИТИЧЕСКАЯ ОШИБКА при инициализации МИШУРА:', error);
        showFallbackError();
    }
});

// Запасной вариант для отображения ошибки, если основной код не загрузился
function showFallbackError() {
    const errorMessage = 'Не удалось загрузить приложение. Пожалуйста, обновите страницу или попробуйте позже.';
    
    // Проверяем, существует ли элемент toast
    const toastElement = document.getElementById('toast');
    if (toastElement) {
        toastElement.textContent = errorMessage;
        toastElement.classList.add('show');
        // Не убираем сообщение об ошибке автоматически
    } else {
        // Создаем простой алерт, если нет элемента toast
        alert(errorMessage);
    }
}