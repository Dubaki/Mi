<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –¢–ï–°–¢ –ú–ò–®–£–†–´ - –ü–∞—Ç—á–∏ V2 (–ò–°–ü–†–ê–í–õ–ï–ù–û)</title>
    
    <!-- –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò -->
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --accent-gold: #d4af37;
            --accent-gold-hover: #b8941f;
            --accent-gold-light: rgba(212, 175, 55, 0.1);
            --border-color: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .test-header {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid #ff4444;
            border-radius: 12px;
            padding: 16px;
            margin: 20px;
            text-align: center;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            padding: 20px 16px 100px 16px;
            position: relative;
            z-index: 1;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 3.2rem;
            font-weight: 900;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #d4af37 0%, #f7dc6f 50%, #d4af37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }

        .action-btn {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-gold);
            padding: 24px 28px;
            border-radius: 24px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-gold);
            cursor: pointer;
            transition: all 0.4s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .action-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 32px rgba(212, 175, 55, 0.2);
            border-color: #f7dc6f;
            color: #f7dc6f;
        }

        .action-btn .icon {
            display: inline-block;
            margin-right: 12px;
            font-size: 1.4rem;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--accent-gold);
            padding: 12px 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 420px;
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 20px;
        }

        .nav-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.4s ease;
            padding: 12px 8px;
            border-radius: 12px;
            min-width: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .nav-btn.active {
            color: var(--accent-gold);
        }

        .nav-btn:hover {
            color: var(--accent-gold);
            transform: translateY(-2px);
        }

        .nav-icon {
            font-size: 1.3rem;
        }

        .nav-text {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(15px);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-overlay.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 20px 0;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 2px solid var(--accent-gold);
            border-radius: 24px;
            padding: 32px 24px;
            max-width: 400px;
            width: 90%;
            margin: auto;
            color: var(--text-primary);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--accent-gold);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .close-btn {
            background: none;
            border: 2px solid var(--accent-gold);
            color: var(--accent-gold);
            font-size: 1.4rem;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.4s ease;
            line-height: 1;
        }

        .close-btn:hover {
            background: var(--accent-gold);
            color: var(--bg-primary);
            transform: rotate(90deg);
        }

        .upload-mode {
            display: none;
        }

        .upload-mode.active {
            display: block;
        }

        .upload-area {
            border: 2px dashed rgba(212, 175, 55, 0.3);
            border-radius: 16px;
            padding: 32px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            background: rgba(212, 175, 55, 0.02);
            margin-bottom: 24px;
        }

        .upload-area:hover {
            border-color: var(--accent-gold);
            background: rgba(212, 175, 55, 0.05);
            transform: translateY(-2px);
        }

        .upload-text {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 500;
        }

        .compare-slots {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .compare-slot {
            aspect-ratio: 1;
            border: 2px dashed rgba(212, 175, 55, 0.3);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: rgba(212, 175, 55, 0.02);
        }

        .compare-slot:hover {
            border-color: var(--accent-gold);
            background: rgba(212, 175, 55, 0.05);
            transform: scale(1.02);
        }

        .slot-number {
            position: absolute;
            top: 8px;
            left: 8px;
            background: linear-gradient(135deg, #d4af37 0%, #f7dc6f 100%);
            color: var(--bg-primary);
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            z-index: 2;
        }

        .add-icon {
            font-size: 2rem;
            color: var(--text-secondary);
            transition: all 0.4s ease;
        }

        .compare-slot:hover .add-icon {
            color: var(--accent-gold);
            transform: scale(1.1);
        }

        /* –¢–ï–°–¢–û–í–´–ï –≠–õ–ï–ú–ï–ù–¢–´ */
        .test-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--accent-gold);
            border-radius: 8px;
            padding: 12px;
            z-index: 10000;
            font-size: 12px;
        }

        .test-btn {
            background: linear-gradient(135deg, #d4af37 0%, #f7dc6f 100%);
            color: var(--bg-primary);
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 2px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .test-log {
            position: fixed;
            bottom: 80px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--accent-gold);
            border-radius: 8px;
            padding: 12px;
            max-height: 150px; /* –£–º–µ–Ω—å—à–∏–ª–∏ –≤—ã—Å–æ—Ç—É */
            overflow-y: auto;
            font-family: monospace;
            font-size: 11px; /* –£–º–µ–Ω—å—à–∏–ª–∏ —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            color: #00ff00;
            z-index: 9998; /* –ü–æ–Ω–∏–∑–∏–ª–∏ z-index */
            opacity: 0.8; /* –°–¥–µ–ª–∞–ª–∏ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º */
            transition: opacity 0.3s ease;
        }
        
        .test-log:hover {
            opacity: 1; /* –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–¥–∏–º—ã–º */
        }

        .hidden-input {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –¢–ï–°–¢–û–í–ê–Ø –®–ê–ü–ö–ê -->
    <div class="test-header">
        <h2 style="color: #ff4444; margin: 0;">üß™ –¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú –ú–ò–®–£–†–´</h2>
        <p style="color: #ffaa44; margin: 4px 0;">–í–µ—Ä—Å–∏—è —Å –ø–∞—Ç—á–∞–º–∏ V2 ‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
    </div>

    <!-- –¢–ï–°–¢–û–í–´–ï –ö–û–ù–¢–†–û–õ–´ -->
    <div class="test-controls">
        <div style="color: var(--accent-gold); font-weight: 600; margin-bottom: 8px;">üîß –¢–µ—Å—Ç—ã</div>
        <button class="test-btn" onclick="runDiagnostics()">üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
        <button class="test-btn" onclick="testAPI()">üåê API</button>
        <button class="test-btn" onclick="testNavigation()">üß≠ –ù–∞–≤–∏–≥–∞—Ü–∏—è</button>
        <button class="test-btn" onclick="toggleTestLog()">üìñ –õ–æ–≥</button>
        <button class="test-btn" onclick="clearTestLog()">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
    <div class="container">
        <header class="header">
            <h1>‚ú® –ú–ò–®–£–†–ê</h1>
            <p>Luxury –ò–ò-—Å—Ç–∏–ª–∏—Å—Ç –ø—Ä–µ–º–∏—É–º –∫–ª–∞—Å—Å–∞</p>
        </header>

        <div class="action-buttons">
            <button id="single-mode-btn" class="action-btn">
                <span class="icon">üì∑</span>
                –ê–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–∞
            </button>
            <button id="compare-mode-btn" class="action-btn">
                <span class="icon">üîÑ</span>
                –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
            </button>
        </div>
    </div>

    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
    <nav class="bottom-nav">
        <div class="nav-container">
            <button id="nav-home" class="nav-btn active">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            <button id="nav-history" class="nav-btn">
                <span class="nav-icon">üìö</span>
                <span class="nav-text">–ò—Å—Ç–æ—Ä–∏—è</span>
            </button>
            <button id="nav-balance" class="nav-btn">
                <span class="nav-icon">üí∞</span>
                <span class="nav-text">–ë–∞–ª–∞–Ω—Å</span>
            </button>
        </div>
    </nav>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û -->
    <div id="consultation-overlay" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title" class="modal-title">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å—Ç–∏–ª–∏—Å—Ç–∞</h2>
                <button id="consultation-cancel" class="close-btn">&times;</button>
            </div>

            <!-- Single —Ä–µ–∂–∏–º -->
            <div id="single-mode" class="upload-mode">
                <div id="single-preview" class="upload-area">
                    <div class="upload-text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ</div>
                </div>
            </div>

            <!-- Compare —Ä–µ–∂–∏–º -->
            <div id="compare-mode" class="upload-mode">
                <h3 style="color: var(--accent-gold); text-align: center; margin-bottom: 16px;">
                    –ó–∞–≥—Ä—É–∑–∏—Ç–µ 2-4 —Ñ–æ—Ç–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                </h3>
                <div class="compare-slots">
                    <div class="compare-slot" data-slot="0">
                        <span class="slot-number">1</span>
                        <span class="add-icon">+</span>
                    </div>
                    <div class="compare-slot" data-slot="1">
                        <span class="slot-number">2</span>
                        <span class="add-icon">+</span>
                    </div>
                    <div class="compare-slot" data-slot="2">
                        <span class="slot-number">3</span>
                        <span class="add-icon">+</span>
                    </div>
                    <div class="compare-slot" data-slot="3">
                        <span class="slot-number">4</span>
                        <span class="add-icon">+</span>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div id="consultation-form" style="display: none;">
                <div style="margin-bottom: 16px;">
                    <label style="color: var(--accent-gold); display: block; margin-bottom: 8px;">
                        –ü–æ–≤–æ–¥:
                    </label>
                    <input type="text" id="occasion" value="—Ç–µ—Å—Ç" style="
                        width: 100%;
                        padding: 12px;
                        background: var(--bg-tertiary);
                        border: 1px solid var(--accent-gold);
                        border-radius: 8px;
                        color: var(--text-primary);
                    ">
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button id="form-cancel" class="close-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button id="form-submit" style="
                        background: var(--accent-gold);
                        color: var(--bg-primary);
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        flex: 1;
                        position: relative;
                        z-index: 10001; /* –í—ã—Å–æ–∫–∏–π z-index –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
                    ">–ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç</button>
                </div>
            </div>

            <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
            <div id="loading" style="display: none; text-align: center; padding: 32px;">
                <div style="
                    width: 40px;
                    height: 40px;
                    border: 3px solid rgba(212, 175, 55, 0.3);
                    border-top: 3px solid var(--accent-gold);
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                    margin: 0 auto 16px;
                "></div>
                <p style="color: var(--accent-gold);">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞—à –æ–±—Ä–∞–∑...</p>
            </div>

            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
            <div id="result" style="display: none;">
                <h3 style="color: var(--accent-gold); text-align: center; margin-bottom: 16px;">
                    üíé –°–æ–≤–µ—Ç —Å—Ç–∏–ª–∏—Å—Ç–∞
                </h3>
                <div id="result-content" style="
                    background: rgba(212, 175, 55, 0.05);
                    border: 1px solid rgba(212, 175, 55, 0.3);
                    border-radius: 12px;
                    padding: 20px;
                    line-height: 1.6;
                    margin-bottom: 20px;
                "></div>
                
                <!-- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button id="result-back" style="
                        background: var(--bg-tertiary);
                        color: var(--text-primary);
                        border: 1px solid var(--accent-gold);
                        padding: 12px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    ">‚Üê –ù–∞–∑–∞–¥ –∫ –≤—ã–±–æ—Ä—É</button>
                    <button id="result-new" style="
                        background: var(--accent-gold);
                        color: var(--bg-primary);
                        border: none;
                        padding: 12px 20px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: 600;
                        transition: all 0.3s ease;
                    ">üÜï –ù–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–ö–†–´–¢–´–ï –ò–ù–ü–£–¢–´ -->
    <input type="file" id="single-file-input" class="hidden-input" accept="image/*">
    <input type="file" id="compare-file-input-0" class="hidden-input" accept="image/*">
    <input type="file" id="compare-file-input-1" class="hidden-input" accept="image/*">
    <input type="file" id="compare-file-input-2" class="hidden-input" accept="image/*">
    <input type="file" id="compare-file-input-3" class="hidden-input" accept="image/*">

    <!-- –¢–ï–°–¢–û–í–´–ô –õ–û–ì -->
    <div class="test-log" id="test-log">
        üß™ –¢–µ—Å—Ç–æ–≤—ã–π –ª–æ–≥ –∑–∞–≥—Ä—É–∂–µ–Ω...<br>
    </div>

    <!-- –ê–ù–ò–ú–ê–¶–ò–Ø –°–ü–ò–ù–ù–ï–†–ê -->
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <!-- MOCK API -->
    <script>
        // Mock API Service –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        class MockMishuraAPIService {
            constructor() {
                this.baseURL = '/api/v1';
                this.timeout = 90000;
                this.testLog('‚úÖ Mock API —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
            }

            async analyzeSingle(imageFile, occasion, preferences) {
                this.testLog('üì§ Mock analyzeSingle –≤—ã–∑–≤–∞–Ω');
                
                // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                return {
                    status: 'success',
                    advice: `
# üé® –¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–∞ –æ—Ç –ú–ò–®–£–†–´

**–ü–æ–≤–æ–¥**: ${occasion}

## –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞
–í–∞—à –æ–±—Ä–∞–∑ –¥–ª—è ${occasion} –≤—ã–≥–ª—è–¥–∏—Ç –æ—Ç–ª–∏—á–Ω–æ! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Mock API —Å –ø–∞—Ç—á–∞–º–∏ V2.

## üåà –¶–≤–µ—Ç–æ–≤–∞—è –≥–∞–º–º–∞
–í—ã–±—Ä–∞–Ω–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ —Å–ª—É—á–∞—é.

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –¢–µ—Å—Ç–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1: –î–æ–±–∞–≤—å—Ç–µ —è—Ä–∫–∏–π –∞–∫—Å–µ—Å—Å—É–∞—Ä
- –¢–µ—Å—Ç–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 2: –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –¥—Ä—É–≥—É—é –æ–±—É–≤—å
- –¢–µ—Å—Ç–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ –æ–±—Ä–∞–∑ –ø–æ–¥—Ö–æ–¥—è—â–µ–π —Å—É–º–æ—á–∫–æ–π

## ‚≠ê –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞: 9/10

üí° **–°–æ–≤–µ—Ç –æ—Ç –ú–ò–®–£–†–´**: –î–ª—è –µ—â–µ –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (–¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú)
                    `.trim(),
                    metadata: {
                        timestamp: new Date().toISOString(),
                        testMode: true,
                        apiVersion: 'v2-patched'
                    }
                };
            }

            async analyzeCompare(imageFiles, occasion, preferences) {
                this.testLog(`üì§ Mock analyzeCompare –≤—ã–∑–≤–∞–Ω (${imageFiles.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)`);
                
                await new Promise(resolve => setTimeout(resolve, 3000));
                
                return {
                    status: 'success',
                    advice: `
# üèÜ –¢–µ—Å—Ç–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ –æ—Ç –ú–ò–®–£–†–´

**–ü–æ–≤–æ–¥**: ${occasion}

## –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
**–õ—É—á—à–∏–π –æ–±—Ä–∞–∑ –¥–ª—è ${occasion}**: –û–±—Ä–∞–∑ ‚Ññ1 –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –±–ª–∞–≥–æ–¥–∞—Ä—è –ª—É—á—à–µ–º—É —Å–æ—á–µ—Ç–∞–Ω–∏—é —Ü–≤–µ—Ç–æ–≤.

## üìä –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ

### ü•á –û–±—Ä–∞–∑ ‚Ññ1 - –û—Ü–µ–Ω–∫–∞: 9/10
- **–ü–ª—é—Å—ã**: –û—Ç–ª–∏—á–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤, –∏–¥–µ–∞–ª—å–Ω–∞—è –ø–æ—Å–∞–¥–∫–∞
- **–ú–∏–Ω—É—Å—ã**: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∏–¥–µ–∞–ª–µ–Ω
- **–°–æ–≤–µ—Ç**: –î–æ–±–∞–≤—å—Ç–µ —è—Ä–∫–∏–π –∞–∫—Å–µ—Å—Å—É–∞—Ä

### ü•à –û–±—Ä–∞–∑ ‚Ññ2 - –û—Ü–µ–Ω–∫–∞: 7.5/10
- **–ü–ª—é—Å—ã**: –•–æ—Ä–æ—à–∏–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏, –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å
- **–ú–∏–Ω—É—Å—ã**: –¶–≤–µ—Ç–æ–≤–∞—è –≥–∞–º–º–∞ –º–æ–≥–ª–∞ –±—ã –±—ã—Ç—å —è—Ä—á–µ
- **–°–æ–≤–µ—Ç**: –ó–∞–º–µ–Ω–∏—Ç–µ –≤–µ—Ä—Ö –Ω–∞ –±–æ–ª–µ–µ —è—Ä–∫–∏–π

## üí° –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
–í—Å–µ –æ–±—Ä–∞–∑—ã –∏–º–µ—é—Ç —Å–≤–æ–∏ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞. –í—ã–±–∏—Ä–∞–π—Ç–µ –∏—Å—Ö–æ–¥—è –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è!

üí° **–°–æ–≤–µ—Ç –æ—Ç –ú–ò–®–£–†–´**: –û—Ç–ª–∏—á–Ω—ã–µ —Ñ–æ—Ç–æ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è! (–¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú)
                    `.trim(),
                    metadata: {
                        timestamp: new Date().toISOString(),
                        testMode: true,
                        apiVersion: 'v2-patched'
                    }
                };
            }

            testLog(message) {
                const timestamp = new Date().toLocaleTimeString();
                const logElement = document.getElementById('test-log');
                if (logElement) {
                    logElement.innerHTML += `[${timestamp}] ${message}<br>`;
                    logElement.scrollTop = logElement.scrollHeight;
                }
                console.log(`[TEST] ${message}`);
            }
        }

        // –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä Mock API
        window.MishuraAPIService = MockMishuraAPIService;
        window.mockAPI = new MockMishuraAPIService();

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function testLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('test-log');
            if (logElement) {
                logElement.innerHTML += `[${timestamp}] ${message}<br>`;
                logElement.scrollTop = logElement.scrollHeight;
            }
            console.log(`[TEST] ${message}`);
        }

        function runDiagnostics() {
            if (window.mishuraApp && window.mishuraApp.diagnostics) {
                window.mishuraApp.diagnostics();
                testLog('üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ (—Å–º. –∫–æ–Ω—Å–æ–ª—å)');
            } else {
                testLog('‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            }
        }

        function testAPI() {
            testLog('üåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API...');
            if (window.mishuraApp && window.mishuraApp.api) {
                testLog('‚úÖ API –ø–æ–¥–∫–ª—é—á–µ–Ω');
                
                // –¢–µ—Å—Ç —Å mock —Ñ–∞–π–ª–æ–º
                const mockFile = new File(['test'], 'test.jpg', { type: 'image/jpeg' });
                window.mishuraApp.api.analyzeSingle(mockFile, '—Ç–µ—Å—Ç', '—Ç–µ—Å—Ç–æ–≤—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è')
                    .then(result => {
                        testLog('‚úÖ API —Ç–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω');
                    })
                    .catch(error => {
                        testLog(`‚ùå API —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω: ${error.message}`);
                    });
            } else {
                testLog('‚ùå API –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        }

        function testNavigation() {
            testLog('üß≠ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏...');
            if (window.mishuraApp) {
                const sections = ['home', 'history', 'balance'];
                sections.forEach(section => {
                    try {
                        window.mishuraApp.navigateToSection(section);
                        testLog(`‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –≤ ${section} —É—Å–ø–µ—à–µ–Ω`);
                    } catch (error) {
                        testLog(`‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ ${section}: ${error.message}`);
                    }
                });
            } else {
                testLog('‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            }
        }

        function clearTestLog() {
            const logElement = document.getElementById('test-log');
            if (logElement) {
                logElement.innerHTML = 'üßπ –õ–æ–≥ –æ—á–∏—â–µ–Ω...<br>';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –ª–æ–≥–∞
        function toggleTestLog() {
            const logElement = document.getElementById('test-log');
            if (logElement) {
                if (logElement.style.maxHeight === '30px') {
                    logElement.style.maxHeight = '150px';
                    testLog('üìñ –õ–æ–≥ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç');
                } else {
                    logElement.style.maxHeight = '30px';
                    testLog('üìï –õ–æ–≥ —Å–≤–µ—Ä–Ω—É—Ç');
                }
            }
        }
    </script>

    <!-- –û–°–ù–û–í–ù–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï -->
    <script>
        // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è MishuraApp –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        class MishuraApp {
            constructor() {
                console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MishuraApp –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...');
                
                this.currentMode = null;
                this.currentSection = 'home';
                this.compareImages = [null, null, null, null];
                this.singleImage = null;
                this.isLoading = false;
                this.initializationComplete = false;
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API
                this.api = null;
                this.initializeAPI();
                
                // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                setTimeout(() => this.init(), 100);
            }

            initializeAPI() {
                try {
                    if (window.MishuraAPIService) {
                        this.api = new window.MishuraAPIService();
                        console.log('‚úÖ API —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ–∑–¥–∞–Ω:', this.api);
                        testLog('‚úÖ API —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–æ–∑–¥–∞–Ω');
                    } else {
                        console.warn('‚ö†Ô∏è API –Ω–µ –Ω–∞–π–¥–µ–Ω');
                        testLog('‚ö†Ô∏è API –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ API:', error);
                    testLog(`‚ùå –û—à–∏–±–∫–∞ API: ${error.message}`);
                }
            }

            init() {
                try {
                    console.log('üéØ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...');
                    testLog('üéØ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è');
                    
                    this.setupModeButtons();
                    this.setupNavigation();
                    this.setupModal();
                    this.setupUploaders();
                    
                    this.initializationComplete = true;
                    console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                    testLog('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    testLog(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`);
                }
            }

            setupModeButtons() {
                const singleBtn = document.getElementById('single-mode-btn');
                const compareBtn = document.getElementById('compare-mode-btn');
                
                if (singleBtn) {
                    singleBtn.addEventListener('click', () => {
                        console.log('üî• Single Mode clicked');
                        testLog('üî• Single Mode –∫–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞');
                        this.openSingleModal();
                    });
                    testLog('‚úÖ Single –∫–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
                }
                
                if (compareBtn) {
                    compareBtn.addEventListener('click', () => {
                        console.log('üîÑ Compare Mode clicked');
                        testLog('üîÑ Compare Mode –∫–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞');
                        this.openCompareModal();
                    });
                    testLog('‚úÖ Compare –∫–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
                }
            }

            setupNavigation() {
                const navButtons = document.querySelectorAll('.nav-btn');
                navButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const section = btn.id.replace('nav-', '');
                        console.log(`üß≠ –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ ${section}`);
                        testLog(`üß≠ –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª: ${section}`);
                        this.navigateToSection(section);
                    });
                });
                testLog('‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
            }

            setupModal() {
                const closeBtn = document.getElementById('consultation-cancel');
                const cancelBtn = document.getElementById('form-cancel');
                const submitBtn = document.getElementById('form-submit');
                const resultBackBtn = document.getElementById('result-back');
                const resultNewBtn = document.getElementById('result-new');
                
                if (closeBtn) {
                    closeBtn.addEventListener('click', () => {
                        testLog('‚ùå –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ');
                        this.closeModal();
                    });
                }
                
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', () => {
                        testLog('‚ùå –§–æ—Ä–º–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞');
                        this.closeModal();
                    });
                }
                
                if (submitBtn) {
                    submitBtn.addEventListener('click', () => {
                        testLog('üì§ –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
                        this.submitForm();
                    });
                }
                
                if (resultBackBtn) {
                    resultBackBtn.addEventListener('click', () => {
                        testLog('‚¨ÖÔ∏è –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π');
                        this.backToSelection();
                    });
                }
                
                if (resultNewBtn) {
                    resultNewBtn.addEventListener('click', () => {
                        testLog('üÜï –ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞');
                        this.startNewAnalysis();
                    });
                }
                
                testLog('‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ');
            }

            setupUploaders() {
                // Single upload
                const singlePreview = document.getElementById('single-preview');
                const singleInput = document.getElementById('single-file-input');
                
                if (singlePreview && singleInput) {
                    singlePreview.addEventListener('click', () => {
                        testLog('üìÅ –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è Single —Ä–µ–∂–∏–º–∞');
                        singleInput.click();
                    });
                    
                    singleInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            testLog(`üì∑ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω: ${file.name}`);
                            this.singleImage = file;
                            this.updateSinglePreview(file);
                            this.showForm();
                        }
                    });
                }
                
                // Compare uploads
                for (let i = 0; i < 4; i++) {
                    const slot = document.querySelector(`[data-slot="${i}"]`);
                    const input = document.getElementById(`compare-file-input-${i}`);
                    
                    if (slot && input) {
                        slot.addEventListener('click', () => {
                            testLog(`üìÅ –í—ã–±–æ—Ä —Ñ–∞–π–ª–∞ –¥–ª—è —Å–ª–æ—Ç–∞ ${i + 1}`);
                            input.click();
                        });
                        
                        input.addEventListener('change', (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                testLog(`üì∑ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —Å–ª–æ—Ç ${i + 1}: ${file.name}`);
                                this.compareImages[i] = file;
                                this.updateComparePreview(i, file);
                                this.checkCompareReady();
                            }
                        });
                    }
                }
                
                testLog('‚úÖ –ó–∞–≥—Ä—É–∑—á–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
            }

            openSingleModal() {
                this.currentMode = 'single';
                const overlay = document.getElementById('consultation-overlay');
                const singleMode = document.getElementById('single-mode');
                const compareMode = document.getElementById('compare-mode');
                const title = document.getElementById('modal-title');
                
                if (overlay) overlay.classList.add('active');
                if (singleMode) singleMode.classList.add('active');
                if (compareMode) compareMode.classList.remove('active');
                if (title) title.textContent = '–ê–Ω–∞–ª–∏–∑ –æ–±—Ä–∞–∑–∞';
                
                this.hideForm();
                this.hideLoading();
                this.hideResult();
                
                testLog('üî• –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Single —Ä–µ–∂–∏–º–∞ –æ—Ç–∫—Ä—ã—Ç–æ');
            }

            openCompareModal() {
                this.currentMode = 'compare';
                const overlay = document.getElementById('consultation-overlay');
                const singleMode = document.getElementById('single-mode');
                const compareMode = document.getElementById('compare-mode');
                const title = document.getElementById('modal-title');
                
                if (overlay) overlay.classList.add('active');
                if (singleMode) singleMode.classList.remove('active');
                if (compareMode) compareMode.classList.add('active');
                if (title) title.textContent = '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤';
                
                this.hideForm();
                this.hideLoading();
                this.hideResult();
                
                testLog('üîÑ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Compare —Ä–µ–∂–∏–º–∞ –æ—Ç–∫—Ä—ã—Ç–æ');
            }

            closeModal() {
                const overlay = document.getElementById('consultation-overlay');
                if (overlay) overlay.classList.remove('active');
                
                this.clearForm();
                this.clearImages();
            }

            navigateToSection(section) {
                this.currentSection = section;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                const targetBtn = document.getElementById(`nav-${section}`);
                if (targetBtn) {
                    targetBtn.classList.add('active');
                }
                
                testLog(`‚úÖ –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª ${section} –≤—ã–ø–æ–ª–Ω–µ–Ω`);
            }

            showForm() {
                const form = document.getElementById('consultation-form');
                if (form) {
                    form.style.display = 'block';
                    testLog('üìù –§–æ—Ä–º–∞ –ø–æ–∫–∞–∑–∞–Ω–∞');
                }
            }

            hideForm() {
                const form = document.getElementById('consultation-form');
                if (form) form.style.display = 'none';
            }

            showLoading() {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = 'block';
                    testLog('‚è≥ –ü–æ–∫–∞–∑–∞–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏');
                }
                this.hideForm();
                this.hideResult();
            }

            hideLoading() {
                const loading = document.getElementById('loading');
                if (loading) loading.style.display = 'none';
            }

            showResult(result) {
                const resultDiv = document.getElementById('result');
                const content = document.getElementById('result-content');
                
                if (resultDiv && content) {
                    content.innerHTML = this.formatAdvice(result.advice);
                    resultDiv.style.display = 'block';
                    testLog('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∑–∞–Ω');
                }
                
                this.hideForm();
                this.hideLoading();
            }

            hideResult() {
                const result = document.getElementById('result');
                if (result) result.style.display = 'none';
            }

            formatAdvice(advice) {
                if (!advice) return '';
                
                // –ü—Ä–æ—Å—Ç–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Markdown
                let formatted = advice;
                formatted = formatted.replace(/^# (.*$)/gm, '<h2 style="color: var(--accent-gold); margin: 16px 0 8px;">$1</h2>');
                formatted = formatted.replace(/^## (.*$)/gm, '<h3 style="color: var(--accent-gold); margin: 12px 0 6px;">$1</h3>');
                formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong style="color: var(--accent-gold);">$1</strong>');
                formatted = formatted.replace(/^- (.*$)/gm, '<li>$1</li>');
                formatted = formatted.replace(/(<li>.*<\/li>)/gs, '<ul style="margin: 8px 0; padding-left: 20px;">$1</ul>');
                
                return formatted;
            }

            updateSinglePreview(file) {
                const preview = document.getElementById('single-preview');
                if (preview && file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        preview.innerHTML = `
                            <img src="${e.target.result}" style="
                                width: 120px; 
                                height: 120px; 
                                object-fit: cover; 
                                border-radius: 12px;
                                margin: 0 auto;
                                display: block;
                                border: 2px solid var(--accent-gold);
                            ">
                            <div style="color: var(--accent-gold); margin-top: 8px; font-size: 0.9rem;">
                                ${file.name}
                            </div>
                        `;
                        testLog('üñºÔ∏è Single –ø—Ä–µ–≤—å—é –æ–±–Ω–æ–≤–ª–µ–Ω–æ');
                    };
                    reader.readAsDataURL(file);
                }
            }

            updateComparePreview(index, file) {
                const slot = document.querySelector(`[data-slot="${index}"]`);
                if (slot && file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        slot.innerHTML = `
                            <span class="slot-number">${index + 1}</span>
                            <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 14px;">
                        `;
                    };
                    reader.readAsDataURL(file);
                }
            }

            checkCompareReady() {
                const loadedImages = this.compareImages.filter(img => img !== null).length;
                if (loadedImages >= 2) {
                    this.showForm();
                    testLog(`üîÑ Compare –≥–æ—Ç–æ–≤: –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${loadedImages} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`);
                }
            }

            clearForm() {
                const occasion = document.getElementById('occasion');
                if (occasion) occasion.value = '—Ç–µ—Å—Ç';
            }

            clearImages() {
                this.singleImage = null;
                this.compareImages = [null, null, null, null];
                
                // –û—á–∏—â–∞–µ–º –ø—Ä–µ–≤—å—é
                const singlePreview = document.getElementById('single-preview');
                if (singlePreview) {
                    singlePreview.innerHTML = '<div class="upload-text">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ</div>';
                    testLog('üßπ Single –ø—Ä–µ–≤—å—é –æ—á–∏—â–µ–Ω–æ');
                }
                
                // –û—á–∏—â–∞–µ–º —Å–ª–æ—Ç—ã
                for (let i = 0; i < 4; i++) {
                    const slot = document.querySelector(`[data-slot="${i}"]`);
                    if (slot) {
                        slot.innerHTML = `
                            <span class="slot-number">${i + 1}</span>
                            <span class="add-icon">+</span>
                        `;
                    }
                }
                testLog('üßπ –í—Å–µ –ø—Ä–µ–≤—å—é –æ—á–∏—â–µ–Ω—ã');
            }

            async submitForm() {
                if (!this.api) {
                    testLog('‚ùå API –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                    return;
                }
                
                const occasion = document.getElementById('occasion')?.value || '—Ç–µ—Å—Ç';
                
                this.showLoading();
                
                try {
                    let result;
                    
                    if (this.currentMode === 'single' && this.singleImage) {
                        testLog('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ Single –∞–Ω–∞–ª–∏–∑–∞...');
                        result = await this.api.analyzeSingle(this.singleImage, occasion, '');
                    } else if (this.currentMode === 'compare') {
                        const images = this.compareImages.filter(img => img !== null);
                        if (images.length >= 2) {
                            testLog(`üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ Compare –∞–Ω–∞–ª–∏–∑–∞ (${images.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)...`);
                            result = await this.api.analyzeCompare(images, occasion, '');
                        } else {
                            throw new Error('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                        }
                    } else {
                        throw new Error('–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
                    }
                    
                    testLog('‚úÖ –ê–Ω–∞–ª–∏–∑ –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                    this.showResult(result);
                    
                } catch (error) {
                    testLog(`‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: ${error.message}`);
                    this.hideLoading();
                    this.showForm();
                }
            }

            backToSelection() {
                this.hideResult();
                
                if (this.currentMode === 'single') {
                    const singleMode = document.getElementById('single-mode');
                    if (singleMode) singleMode.classList.add('active');
                } else if (this.currentMode === 'compare') {
                    const compareMode = document.getElementById('compare-mode');
                    if (compareMode) compareMode.classList.add('active');
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                if ((this.currentMode === 'single' && this.singleImage) || 
                    (this.currentMode === 'compare' && this.compareImages.filter(img => img !== null).length >= 2)) {
                    this.showForm();
                }
            }

            startNewAnalysis() {
                this.closeModal();
                testLog('üîÑ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞');
            }

            diagnostics() {
                console.log('üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê MISHURA APP:');
                console.log('üîß API —Å—Ç–∞—Ç—É—Å:', this.api ? '–ü–æ–¥–∫–ª—é—á–µ–Ω' : '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω');
                console.log('üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', {
                    single: !!this.singleImage,
                    compare: this.compareImages.filter(img => img !== null).length
                });
                console.log('üì± –¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º:', this.currentMode);
                console.log('üß≠ –¢–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª:', this.currentSection);
                console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:', this.initializationComplete);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üì± DOM –≥–æ—Ç–æ–≤, —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ...');
            testLog('üì± DOM –≥–æ—Ç–æ–≤');
            
            try {
                window.mishuraApp = new MishuraApp();
                testLog('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ');
                
                setTimeout(() => {
                    if (window.mishuraApp && window.mishuraApp.initializationComplete) {
                        testLog('üéä –ú–ò–®–£–†–ê –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!');
                    } else {
                        testLog('‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π');
                    }
                }, 2000);
                
            } catch (error) {
                console.error('üí• –û–®–ò–ë–ö–ê:', error);
                testLog(`üí• –û–®–ò–ë–ö–ê: ${error.message}`);
            }
        });
    </script>
</body>
</html>